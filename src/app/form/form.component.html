<div class="bg-gray-100 min-h-screen">
  <!-- Header -->
  <app-header [esEdicion]="esEdicion" [title]="title"></app-header>

  <div class="max-w-5xl mx-auto p-8 mt-4">

    <!-- Formulario -->
    <form
      [formGroup]="formulario"
      (ngSubmit)="submit()"
      class="bg-white rounded-lg shadow-lg overflow-hidden"
    >
      <input type="hidden" formControlName="idRol" />
      <div class="bg-slate-800 py-6 px-6 flex items-center">
        <div class="w-1 h-8 bg-blue-400 mr-4"></div>
        <span class="text-white text-2xl">Datos escolares</span>
      </div>
      <!-- Datos escolares -->
      <div class="p-6 space-y-6">
        <div class="flex flex-col md:flex-row gap-4">
          <!-- Matricula -->
          <div class="w-full flex flex-col bg-slate-100 rounded-lg p-3">
            <label for="matricula" class="block px-1 mb-3 text-lg"
              >Matrícula (no se puede editar)</label
            >
            <input
              type="text"
              formControlName="matricula"
              id="matricula"
              class="w-full max-w-md px-4 py-3 border border-gray-300 rounded-md hover:ring focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white placeholder:text-gray-400 read-only:opacity-50 transition"
              placeholder="Matrícula COBACH"
              readonly
            />
          </div>
          <!-- Sede -->
          <div class="w-full flex flex-col bg-slate-100 rounded-lg p-3">
            <label
              for="idSede"
              class="block px-1 mb-3 text-lg after:ml-0.5 after:text-red-500 after:content-['*']"
              >Selecciona la sede a la que te inscribes</label
            >
            <select
              formControlName="idSede"
              id="idSede"
              class="w-full max-w-md px-4 py-3 border border-gray-300 rounded-md hover:ring focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white placeholder:text-gray-400 disabled:opacity-50 transition"
              [ngClass]="{
                'ring-2 ring-red-500 shadow-lg/25 shadow-red-500':
                  esCampoInvalido('idSede')
              }"
              required
            >
              <option [value]="1">Sede 02 | Tuxtla Gutiérrez</option>
              <option [value]="2">Sede 05 | Venustiano Carranza</option>
              <option [value]="3">Sede 06 | Comitán</option>
              <option [value]="4">Sede 07 | Ocosingo</option>
            </select>
          </div>
        </div>
      </div>
      <div class="bg-slate-800 py-6 px-6 flex items-center">
        <div class="w-1 h-8 bg-blue-400 mr-4"></div>
        <span class="text-white text-2xl">Datos personales</span>
      </div>
      <!-- Datos personales -->
      <div class="p-6 space-y-6">
        <!-- Primera fila -->
        <div class="flex flex-col md:flex-row gap-4">
          <!-- Nombre -->
          <div class="w-full flex flex-col bg-slate-100 rounded-lg p-3">
            <label for="nombre" class="block px-1 mb-3 text-lg">Nombre</label>
            <input
              type="text"
              formControlName="nombre"
              id="nombre"
              class="w-full max-w-md px-4 py-3 border border-gray-300 rounded-md hover:ring focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white placeholder:text-gray-400 disabled:opacity-50 transition"
              placeholder="César Enrique"
              [ngClass]="{
                'ring-2 ring-red-500 shadow-lg/25 shadow-red-500':
                  esCampoInvalido('nombre')
              }"
              required
            />
            <div class="px-1 text-gray-600">Nombre/s</div>
          </div>
          <!-- Apellido Paterno -->
          <div class="w-full flex flex-col bg-slate-100 rounded-lg p-3">
            <label for="apellidoPaterno" class="block px-1 mb-3 text-lg"
              >Apellido Paterno</label
            >
            <input
              type="text"
              formControlName="apellidoPaterno"
              id="apellidoPaterno"
              class="w-full max-w-md px-4 py-3 border border-gray-300 rounded-md hover:ring focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white placeholder:text-gray-400 disabled:opacity-50 transition"
              placeholder="Sánchez"
              [ngClass]="{
                'ring-2 ring-red-500 shadow-lg/25 shadow-red-500':
                  esCampoInvalido('apellidoPaterno')
              }"
              required
            />
            <div class="px-1 text-gray-600">Apellido Paterno</div>
          </div>
          <!-- Apellido Materno -->
          <div class="w-full flex flex-col bg-slate-100 rounded-lg p-3">
            <label for="apellidoMaterno" class="block px-1 mb-3 text-lg"
              >Apellido Materno</label
            >
            <input
              type="text"
              formControlName="apellidoMaterno"
              id="apellidoMaterno"
              class="w-full max-w-md px-4 py-3 border border-gray-300 rounded-md hover:ring focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white placeholder:text-gray-400 disabled:opacity-50 transition"
              placeholder="Montoya"
              [ngClass]="{
                'ring-2 ring-red-500 shadow-lg/25 shadow-red-500':
                  esCampoInvalido('apellidoMaterno')
              }"
              required
            />
            <div class="px-1 text-gray-600">Apellido Materno</div>
          </div>
        </div>
        <!-- Segunda fila -->
        <div class="flex flex-col md:flex-row gap-4">
          <!-- CURP -->
          <div class="w-full flex flex-col bg-slate-100 rounded-lg p-3">
            <label for="curp" class="block px-1 mb-3 text-lg">CURP</label>
            <input
              type="text"
              formControlName="curp"
              id="curp"
              class="w-full max-w-md px-4 py-3 border border-gray-300 rounded-md hover:ring focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white placeholder:text-gray-400 disabled:opacity-50 transition"
              placeholder="SANC890101HCHNSS00"
              [ngClass]="{
                'ring-2 ring-red-500 shadow-lg/25 shadow-red-500':
                  esCampoInvalido('curp')
              }"
              required
            />
          </div>
          <!-- FechaNacimiento -->
          <div class="w-full flex flex-col bg-slate-100 rounded-lg p-3">
            <label for="fechaNacimiento" class="block px-1 mb-3 text-lg"
              >Fecha de nacimiento
            </label>
            <input
              type="date"
              formControlName="fechaNacimiento"
              id="fechaNacimiento"
              class="w-full max-w-md px-4 py-3 border border-gray-300 rounded-md hover:ring focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white placeholder:text-gray-400 disabled:opacity-50 transition"
              [ngClass]="{
                'ring-2 ring-red-500 shadow-lg/25 shadow-red-500':
                  esCampoInvalido('fechaNacimiento')
              }"
              required
            />
          </div>
          <!-- Sexo -->
          <div class="w-full flex flex-col bg-slate-100 rounded-lg p-3">
            <label for="sexoHombre" class="block px-1 mb-3 text-lg">Sexo</label>
            <div class="flex space-x-3 g-3">
              <label class="flex items-center md:flex-1">
                <input
                  formControlName="sexo"
                  type="radio"
                  name="sexo"
                  id="sexoHombre"
                  value="H"
                  class="peer/sexo hidden"
                  required
                />
                <span
                  class="bg-blue-300/65 px-3 py-3 rounded-xl flex md:w-full md:justify-center items-center text-lg peer-checked/sexo:bg-blue-600 peer-checked/sexo:text-white transition hover:cursor-pointer hover:ring-2 hover:ring-blue-800 hover:shadow-lg"
                  [ngClass]="{
                    'ring-2 ring-red-500 shadow-lg/25 shadow-red-500':
                      esCampoInvalido('sexo')
                  }"
                  >Hombre
                </span>
              </label>
              <label class="flex items-center md:flex-1">
                <input
                  formControlName="sexo"
                  type="radio"
                  name="sexo"
                  id="sexoMujer"
                  value="M"
                  class="peer/sexo hidden"
                  required
                />
                <span
                  class="bg-pink-300/65 px-3 py-3 rounded-xl flex items-center md:w-full md:justify-center text-lg peer-checked/sexo:bg-pink-600 peer-checked/sexo:text-white transition hover:cursor-pointer hover:ring-2 hover:ring-pink-800 hover:shadow-lg"
                  [ngClass]="{
                    'ring-2 ring-red-500 shadow-lg/25 shadow-red-500':
                      esCampoInvalido('sexo')
                  }"
                  >Mujer
                </span>
              </label>
            </div>
          </div>
          <!-- Telefono -->
          <div class="w-full flex flex-col bg-slate-100 rounded-lg p-3">
            <label for="telefono" class="block px-1 mb-3 text-lg"
              >Teléfono personal
            </label>
            <input
              type="tel"
              formControlName="telefono"
              id="telefono"
              class="w-full max-w-md px-4 py-3 border border-gray-300 rounded-md hover:ring focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white placeholder:text-gray-400 disabled:opacity-50 transition"
              placeholder="9611234567"
              [ngClass]="{
                'ring-2 ring-red-500 shadow-lg/25 shadow-red-500':
                  esCampoInvalido('telefono')
              }"
              required
            />
          </div>
        </div>
        <!-- Tercera fila -->
        <div class="flex flex-col md:flex-row gap-4">
          <!-- Correo -->
          <div class="w-full flex flex-col bg-slate-100 rounded-lg p-3">
            <label for="correo" class="block px-1 mb-3 text-lg"
              >Correo electrónico</label
            >
            <input
              type="email"
              formControlName="correo"
              id="correo"
              class="w-full max-w-md px-4 py-3 border border-gray-300 rounded-md hover:ring focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white placeholder:text-gray-400 disabled:opacity-50 transition"
              placeholder="cesar@cobach.mx"
              [ngClass]="{
                'ring-2 ring-red-500 shadow-lg/25 shadow-red-500':
                  esCampoInvalido('correo')
              }"
              required
            />
            <div class="px-1 text-gray-600">Correo electrónico personal</div>
          </div>
          <!-- Estado Civil -->
          <div class="w-full flex flex-col bg-slate-100 rounded-lg p-3">
            <label for="estadoCivil" class="block px-1 mb-3 text-lg"
              >Estado civil</label
            >
            <select
              formControlName="estadoCivil"
              id="estadoCivil"
              class="w-full max-w-md px-4 py-3 border border-gray-300 rounded-md hover:ring focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white placeholder:text-gray-400 disabled:opacity-50 transition"
              [ngClass]="{
                'ring-2 ring-red-500 shadow-lg/25 shadow-red-500':
                  esCampoInvalido('estadoCivil')
              }"
              required
            >
              <option value="S">Soltero</option>
              <option value="C">Casado</option>
              <option value="D">Divorciado</option>
            </select>
            <div class="px-1 text-gray-600">Correo electrónico personal</div>
          </div>
          <!-- Nacionalidad -->
          <div class="w-full flex flex-col bg-slate-100 rounded-lg p-3">
            <label for="idNacionalidad" class="block px-1 mb-3 text-lg"
              >Nacionalidad</label
            >
            <select
              formControlName="idNacionalidad"
              id="idNacionalidad"
              class="w-full max-w-md px-4 py-3 border border-gray-300 rounded-md hover:ring focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white placeholder:text-gray-400 disabled:opacity-50 transition"
              [ngClass]="{
                'ring-2 ring-red-500 shadow-lg/25 shadow-red-500':
                  esCampoInvalido('idNacionalidad')
              }"
              required
            >
              <option [value]="1">Mexicana</option>
              <option [value]="2">Extranjera</option>
            </select>
          </div>
        </div>
        <!-- Cuarta fila -->
        <div class="flex flex-col md:flex-row gap-4">
          <!-- HablaLengua -->
          <div class="w-full flex flex-col bg-slate-100 rounded-lg p-3">
            <label for="lenguaSi" class="block px-1 mb-3 text-lg"
              >¿Hablas alguna lengua indígena?</label
            >
            <div class="flex space-x-3">
              <label class="flex items-center">
                <input
                  (click)="toggleEnabled('lenguaSearch', true)"
                  formControlName="hablaLengua"
                  type="radio"
                  name="hablaLengua"
                  id="lenguaSi"
                  [value]="1"
                  class="peer/lengua hidden"
                  required
                />
                <span
                  class="bg-green-300/50 px-3 py-3 rounded-xl flex items-center text-lg peer-checked/lengua:bg-green-600 peer-checked/lengua:text-white transition hover:cursor-pointer hover:ring-2 hover:ring-green-800 hover:shadow-lg"
                  [ngClass]="{
                    'ring-2 ring-red-500 shadow-lg/25 shadow-red-500':
                      esCampoInvalido('hablaLengua')
                  }"
                  ><svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="size-6 mr-1"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="m4.5 12.75 6 6 9-13.5"
                    />
                  </svg>
                  Sí</span
                >
              </label>
              <label class="flex items-center">
                <input
                  (click)="
                    toggleEnabled('lenguaSearch', false); clearLenguaSelection()
                  "
                  formControlName="hablaLengua"
                  type="radio"
                  name="hablaLengua"
                  id="lenguaNo"
                  [value]="0"
                  class="peer/lengua hidden"
                  required
                />
                <span
                  class="bg-red-300/50 px-3 py-3 rounded-xl flex items-center text-lg peer-checked/lengua:bg-red-600/60 peer-checked/lengua:text-white transition hover:cursor-pointer hover:ring-2 hover:ring-red-800 hover:shadow-lg"
                  [ngClass]="{
                    'ring-2 ring-red-500 shadow-lg/25 shadow-red-500':
                      esCampoInvalido('hablaLengua')
                  }"
                  ><svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="size-6 mr-1"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M6 18 18 6M6 6l12 12"
                    />
                  </svg>
                  No</span
                >
              </label>
            </div>
          </div>
          <!-- IdLengua -->
          @if (formulario.get('hablaLengua')?.value === 1) {
          <div
            class="w-full flex flex-col bg-slate-100 rounded-lg p-3 relative"
          >
            <!-- Contenedor para mostrar la lengua seleccionada o el searchbar -->
            @if (hasLenguaSelected()) {
            <!-- Mostrar lengua seleccionada -->
            <div
              class="w-full max-w-md px-4 py-2 border border-gray-300 rounded-md bg-green-50 border-green-500 flex items-center justify-between"
            >
              <div class="flex items-center">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke-width="1.5"
                  stroke="currentColor"
                  class="size-5 mr-2 text-green-600"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="m4.5 12.75 6 6 9-13.5"
                  />
                </svg>
                <span class="text-green-800 font-medium">{{
                  lenguaSeleccionada.Nombre
                }}</span>
              </div>
              <button
                type="button"
                (click)="clearLenguaSelection()"
                class="text-red-800 bg-red-300/50 px-3 py-3 rounded-xl flex items-center text-lg peer-checked/lengua:bg-red-600/60 peer-checked/lengua:text-white transition hover:cursor-pointer hover:ring-2 hover:ring-red-800 hover:shadow-lg"
                title="Cambiar selección"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke-width="1.5"
                  stroke="currentColor"
                  class="size-5"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M6 18 18 6M6 6l12 12"
                  />
                </svg>
              </button>
            </div>
            } @else {
            <!-- Searchbar dinámico -->
            <label for="lenguaSearch" class="block px-1 mb-3 text-lg"
              >¿Cuál?</label
            >
            <input
              type="text"
              formControlName="lenguaSearch"
              id="lenguaSearch"
              (input)="onSearchLengua($event)"
              class="w-full max-w-md px-4 py-3 border border-gray-300 rounded-md hover:ring focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white placeholder:text-gray-400 disabled:opacity-50 transition"
              placeholder="Buscar lengua indígena..."
              autocomplete="off"
              [ngClass]="{
                'ring-2 ring-red-500 shadow-lg/25 shadow-red-500':
                  esCampoInvalido('lenguaSearch')
              }"
              required
            />
            <div class="px-1 text-gray-600">
              @if (lenguaSeleccionada) { Lengua actual:
              {{ lenguaSeleccionada.Nombre }} } @else if (datosAlumno?.IdLengua)
              { Lengua actual: {{ datosAlumno.NombreLengua }}
              } @else { Lengua actual: No especificada }
            </div>

            <!-- Indicador de búsqueda -->
            @if (buscandoLengua) {
            <div class="absolute right-3 top-16 mt-1">
              <div
                class="animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"
              ></div>
            </div>
            }

            <!-- Lista de resultados -->
            @if (lenguasFiltradas.length > 0) {
            <div
              class="absolute top-full left-0 right-0 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto z-10 mt-1"
            >
              @for (lengua of lenguasFiltradas; track $index) {
              <div
                class="px-4 py-3 hover:bg-gray-100 cursor-pointer border-b border-gray-100 last:border-b-0"
                (click)="selectLengua(lengua)"
              >
                <div class="font-medium">{{ lengua.Nombre }}</div>
                @if (lengua.descripcion) {
                <div class="text-sm text-gray-600">
                  {{ lengua.descripcion }}
                </div>
                }
              </div>
              }
            </div>
            }

            <!-- Mensaje cuando no hay resultados -->
            @if (lenguasFiltradas.length === 0 &&
            formulario.get('lenguaSearch')?.value &&
            formulario.get('lenguaSearch')?.value.length >= 2 &&
            !buscandoLengua) {
            <div
              class="absolute top-full left-0 right-0 bg-white border border-gray-300 rounded-md shadow-lg p-4 text-gray-500 text-center z-10 mt-1"
            >
              No se encontraron lenguas que coincidan con tu búsqueda
            </div>
            } }

            <!-- Campo oculto para el ID de la lengua seleccionada -->
            <input type="hidden" formControlName="idLengua" />
          </div>
          }
        </div>
        <!-- Quinta fila -->
        <div class="flex flex-col md:flex-row gap-4">
          <!-- TieneBeca -->
          <div class="w-full flex flex-col bg-slate-100 rounded-lg p-3">
            <label for="becaSi" class="block px-1 mb-3 text-lg"
              >¿Tienes alguna beca activa?</label
            >
            <div class="flex space-x-3">
              <label class="flex items-center">
                <input
                  (click)="toggleEnabled('queBeca', true)"
                  formControlName="tieneBeca"
                  type="radio"
                  name="tieneBeca"
                  id="becaSi"
                  [value]="1"
                  class="peer/beca hidden"
                  required
                />
                <span
                  class="bg-green-300/50 px-3 py-3 rounded-xl flex items-center text-lg peer-checked/beca:bg-green-600 peer-checked/beca:text-white transition hover:cursor-pointer hover:ring-2 hover:ring-green-800 hover:shadow-lg"
                  [ngClass]="{
                    'ring-2 ring-red-500 shadow-lg/25 shadow-red-500':
                      esCampoInvalido('tieneBeca')
                  }"
                  ><svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="size-6 mr-1"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="m4.5 12.75 6 6 9-13.5"
                    />
                  </svg>
                  Sí</span
                >
              </label>
              <label class="flex items-center">
                <input
                  (click)="toggleEnabled('queBeca', false)"
                  formControlName="tieneBeca"
                  type="radio"
                  name="tieneBeca"
                  id="becaNo"
                  [value]="0"
                  class="peer/beca hidden"
                  required
                />
                <span
                  class="bg-red-300/50 px-3 py-3 rounded-xl flex items-center text-lg peer-checked/beca:bg-red-600/60 peer-checked/beca:text-white transition hover:cursor-pointer hover:ring-2 hover:ring-red-800 hover:shadow-lg"
                  [ngClass]="{
                    'ring-2 ring-red-500 shadow-lg/25 shadow-red-500':
                      esCampoInvalido('tieneBeca')
                  }"
                  ><svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="size-6 mr-1"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M6 18 18 6M6 6l12 12"
                    />
                  </svg>
                  No</span
                >
              </label>
            </div>
          </div>
          <!-- QueBeca -->
          @if (formulario.get('tieneBeca')?.value === 1) {
          <div class="w-full flex flex-col bg-slate-100 rounded-lg p-3">
            <label for="queBeca" class="block px-1 mb-3 text-lg"
              >Ingresa el nombre de la beca que tienes activa</label
            >
            <input
              type="text"
              formControlName="queBeca"
              id="queBeca"
              class="w-full max-w-md px-4 py-3 border border-gray-300 rounded-md hover:ring focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white placeholder:text-gray-400 disabled:opacity-50 transition"
              placeholder="Benito Juárez"
              [ngClass]="{
                'ring-2 ring-red-500 shadow-lg/25 shadow-red-500':
                  esCampoInvalido('queBeca')
              }"
              required
            />
          </div>
          }
        </div>
      </div>
      <!-- Datos tutor -->
      @if (menorEdad()){
      <div class="bg-slate-800 py-6 px-6 flex items-center">
        <div class="w-1 h-8 bg-blue-400 mr-4"></div>
        <span class="text-white text-2xl">Datos del tutor</span>
      </div>
      <div class="p-6 space-y-6">
        <!-- Nombre completo del tutor -->
        <div class="flex flex-col md:flex-row gap-4">
          <!-- NombreTutor -->
          <div class="w-full flex flex-col bg-slate-100 rounded-lg p-3">
            <label for="nombreTutor" class="block px-1 mb-3 text-lg"
              >Nombre</label
            >
            <input
              type="text"
              formControlName="nombreTutor"
              id="nombreTutor"
              class="w-full max-w-md px-4 py-3 border border-gray-300 rounded-md hover:ring focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white placeholder:text-gray-400 disabled:opacity-50 transition"
              placeholder="Lucila"
              [ngClass]="{
                'ring-2 ring-red-500 shadow-lg/25 shadow-red-500':
                  esCampoInvalido('nombreTutor')
              }"
              required
            />
            <div class="px-1 text-gray-600">Nombre/s</div>
          </div>
          <!-- ApellidoPaternoTutor -->
          <div class="w-full flex flex-col bg-slate-100 rounded-lg p-3">
            <label for="apellidoPaternoTutor" class="block px-1 mb-3 text-lg"
              >Apellido Paterno</label
            >
            <input
              type="text"
              formControlName="apellidoPaternoTutor"
              id="apellidoPaternoTutor"
              class="w-full max-w-md px-4 py-3 border border-gray-300 rounded-md hover:ring focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white placeholder:text-gray-400 disabled:opacity-50 transition"
              placeholder="Montoya"
              [ngClass]="{
                'ring-2 ring-red-500 shadow-lg/25 shadow-red-500':
                  esCampoInvalido('apellidoPaternoTutor')
              }"
              required
            />
            <div class="px-1 text-gray-600">Apellido Paterno</div>
          </div>
          <!-- ApellidoMaternoTutor -->
          <div class="w-full flex flex-col bg-slate-100 rounded-lg p-3">
            <label for="apellidoMaternoTutor" class="block px-1 mb-3 text-lg"
              >Apellido Materno</label
            >
            <input
              type="text"
              formControlName="apellidoMaternoTutor"
              id="apellidoMaternoTutor"
              class="w-full max-w-md px-4 py-3 border border-gray-300 rounded-md hover:ring focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white placeholder:text-gray-400 disabled:opacity-50 transition"
              placeholder="Ramos"
              [ngClass]="{
                'ring-2 ring-red-500 shadow-lg/25 shadow-red-500':
                  esCampoInvalido('apellidoMaternoTutor')
              }"
              required
            />
            <div class="px-1 text-gray-600">Apellido Materno</div>
          </div>
        </div>
        <!-- TelefonoTutor -->
        <div class="flex-col bg-slate-100 rounded-lg p-3">
          <label for="telefonoTutor" class="block px-1 mb-3 text-lg"
            >Teléfono personal del tutor
          </label>
          <input
            type="tel"
            formControlName="telefonoTutor"
            id="telefonoTutor"
            class="w-full max-w-md px-4 py-3 border border-gray-300 rounded-md hover:ring focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white placeholder:text-gray-400 disabled:opacity-50 transition"
            placeholder="9611234567"
            [ngClass]="{
              'ring-2 ring-red-500 shadow-lg/25 shadow-red-500':
                esCampoInvalido('telefonoTutor')
            }"
            required
          />
        </div>
      </div>
      }
      <div class="bg-slate-800 py-6 px-6 flex items-center">
        <div class="w-1 h-8 bg-blue-400 mr-4"></div>
        <span class="text-white text-2xl">Dirección</span>
      </div>
      <!-- Dirección -->
      <div class="p-6 space-y-6">
        <div class="flex flex-col md:flex-row gap-4">
          <!-- Calle -->
          <div class="w-full flex flex-col bg-slate-100 rounded-lg p-3">
            <label for="calle" class="block px-1 mb-3 text-lg">Calle </label>
            <input
              type="text"
              formControlName="calle"
              id="calle"
              class="w-full max-w-md px-4 py-3 border border-gray-300 rounded-md hover:ring focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white placeholder:text-gray-400 disabled:opacity-50 transition"
              placeholder="Avenida central"
              [ngClass]="{
                'ring-2 ring-red-500 shadow-lg/25 shadow-red-500':
                  esCampoInvalido('calle')
              }"
              required
            />
          </div>
          <!-- Entre calles -->
          <div class="w-full flex flex-col bg-slate-100 rounded-lg p-3">
            <label for="entreCalles" class="block px-1 mb-3 text-lg"
              >Entre calles
            </label>
            <input
              type="text"
              formControlName="entreCalles"
              id="entreCalles"
              class="w-full max-w-md px-4 py-3 border border-gray-300 rounded-md hover:ring focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white placeholder:text-gray-400 disabled:opacity-50 transition"
              placeholder="Avenida 5 de mayo y Avenida 6 de junio"
            />
          </div>
        </div>
        <div class="flex flex-col md:flex-row gap-4">
          <!-- Código postal -->
          <div class="w-full flex flex-col bg-slate-100 rounded-lg p-3">
            <label for="codigoPostal" class="block px-1 mb-3 text-lg"
              >Código postal
            </label>
            <input
              type="text"
              formControlName="codigoPostal"
              id="codigoPostal"
              class="w-full max-w-md px-4 py-3 border border-gray-300 rounded-md hover:ring focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white placeholder:text-gray-400 disabled:opacity-50 transition"
              placeholder="29230"
              [ngClass]="{
                'ring-2 ring-red-500 shadow-lg/25 shadow-red-500':
                  esCampoInvalido('codigoPostal')
              }"
              required
            />
          </div>
          <!-- Número exterior -->
          <div class="w-full flex flex-col bg-slate-100 rounded-lg p-3">
            <label for="numeroExterior" class="block px-1 mb-3 text-lg"
              >Número exterior
            </label>
            <input
              type="text"
              formControlName="numeroExterior"
              id="numeroExterior"
              class="w-full max-w-md px-4 py-3 border border-gray-300 rounded-md hover:ring focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white placeholder:text-gray-400 disabled:opacity-50 transition"
              placeholder="123"
              [ngClass]="{
                'ring-2 ring-red-500 shadow-lg/25 shadow-red-500':
                  esCampoInvalido('numeroExterior')
              }"
              required
            />
          </div>
          <!-- Número interior -->
          <div class="w-full flex flex-col bg-slate-100 rounded-lg p-3">
            <label for="numeroInterior" class="block px-1 mb-3 text-lg"
              >Número interior
            </label>
            <input
              type="text"
              formControlName="numeroInterior"
              id="numeroInterior"
              class="w-full max-w-md px-4 py-3 border border-gray-300 rounded-md hover:ring focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white placeholder:text-gray-400 disabled:opacity-50 transition"
              placeholder="5"
            />
          </div>
          <!-- Localidad -->
          <div
            class="w-full flex flex-col bg-slate-100 rounded-lg p-3 relative"
          >
            <label for="idLocalidad" class="block px-1 mb-3 text-lg"
              >Localidad/Barrio/Colonia
            </label>

            <!-- Contenedor para mostrar la localidad seleccionada o el searchbar -->
            @if (hasLocalidadSelected()) {
            <!-- Mostrar localidad seleccionada -->
            <div
              class="w-full max-w-md px-4 py-2 border border-gray-300 rounded-md bg-green-50 border-green-500 flex items-center justify-between"
            >
              <div class="flex items-center">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke-width="1.5"
                  stroke="currentColor"
                  class="size-5 mr-2 text-green-600"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="m4.5 12.75 6 6 9-13.5"
                  />
                </svg>
                <span class="text-green-800 font-medium">{{
                  localidadSeleccionada.NombreLocalidad ||
                    localidadSeleccionada.Nombre
                }}</span>
              </div>
              <button
                type="button"
                (click)="clearLocalidadSelection()"
                class="text-red-800 bg-red-300/50 px-3 py-3 rounded-xl flex items-center text-lg peer-checked/localidad:bg-red-600/60 peer-checked/localidad:text-white transition hover:cursor-pointer hover:ring-2 hover:ring-red-800 hover:shadow-lg"
                title="Cambiar selección"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke-width="1.5"
                  stroke="currentColor"
                  class="size-5"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M6 18 18 6M6 6l12 12"
                  />
                </svg>
              </button>
            </div>
            } @else {
            <!-- Searchbar dinámico -->
            <input
              type="text"
              formControlName="localidadSearch"
              id="localidadSearch"
              (input)="onSearchLocalidad($event)"
              class="w-full max-w-md px-4 py-3 border border-gray-300 rounded-md hover:ring focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white placeholder:text-gray-400 disabled:opacity-50 transition"
              placeholder="Buscar localidad..."
              autocomplete="off"
              [ngClass]="{
                'ring-2 ring-red-500 shadow-lg/25 shadow-red-500':
                  esCampoInvalido('localidadSearch')
              }"
              required
            />
            <div class="px-1 text-gray-600">
              @if (localidadSeleccionada) { Localidad actual:
              {{
                localidadSeleccionada.NombreLocalidad ||
                  localidadSeleccionada.Nombre
              }}
              } @else if (datosAlumno?.IdLocalidad && datosAlumno?.Localidad) {
              Localidad actual: {{ datosAlumno.Localidad }}
              } @else { Localidad actual: No especificada }
            </div>

            <!-- Indicador de búsqueda -->
            @if (buscandoLocalidad) {
            <div class="absolute right-3 top-16 mt-1">
              <div
                class="animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"
              ></div>
            </div>
            }

            <!-- Lista de resultados -->
            @if (localidadesFiltradas.length > 0) {
            <div
              class="absolute top-full left-0 right-0 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto z-10 mt-1"
            >
              @for (localidad of localidadesFiltradas; track $index) {
              <div
                class="px-4 py-3 hover:bg-gray-100 cursor-pointer border-b border-gray-100 last:border-b-0"
                (click)="selectLocalidad(localidad)"
              >
                <div class="font-medium">
                  {{ localidad.NombreLocalidad || localidad.Nombre }}
                </div>
                @if (localidad.Municipio) {
                <div class="text-sm text-gray-600">
                  {{ localidad.Municipio }}
                </div>
                } @if (localidad.estado) {
                <div class="text-sm text-gray-600">
                  {{ localidad.estado }}
                </div>
                }
              </div>
              }
            </div>
            }

            <!-- Mensaje cuando no hay resultados -->
            @if (localidadesFiltradas.length === 0 &&
            formulario.get('localidadSearch')?.value &&
            formulario.get('localidadSearch')?.value.length >= 2 &&
            !buscandoLocalidad) {
            <div
              class="absolute top-full left-0 right-0 bg-white border border-gray-300 rounded-md shadow-lg p-4 text-gray-500 text-center z-10 mt-1"
            >
              No se encontraron localidades que coincidan con tu búsqueda
            </div>
            } }

            <!-- Campo oculto para el ID de la localidad seleccionada -->
            <input type="hidden" formControlName="idLocalidad" />
          </div>
        </div>
      </div>
      <div class="bg-slate-800 py-6 px-6 flex items-center">
        <div class="w-1 h-8 bg-blue-400 mr-4"></div>
        <span class="text-white text-2xl">Datos médicos</span>
      </div>
      <!-- Datos médicos -->
      <div class="p-6 space-y-6">
        <!-- Alergias -->
        <div class="flex flex-col md:flex-row gap-4">
          <!-- TieneAlergias -->
          <div class="w-full flex flex-col bg-slate-100 rounded-lg p-3">
            <label for="alergiaSi" class="block px-1 mb-3 text-lg"
              >¿Tienes alguna alergia?
            </label>
            <div class="flex space-x-3">
              <label class="flex items-center">
                <input
                  (click)="toggleEnabled('alergias', true)"
                  formControlName="tieneAlergias"
                  type="radio"
                  name="tieneAlergias"
                  id="alergiaSi"
                  [value]="1"
                  class="peer/alergia hidden"
                  required
                />
                <span
                  class="bg-green-300/50 px-3 py-3 rounded-xl flex items-center text-lg peer-checked/alergia:bg-green-600 peer-checked/alergia:text-white transition hover:cursor-pointer hover:ring-2 hover:ring-green-800 hover:shadow-lg"
                  [ngClass]="{
                    'ring-2 ring-red-500 shadow-lg/25 shadow-red-500':
                      esCampoInvalido('tieneAlergias')
                  }"
                  ><svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="size-6 mr-1"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="m4.5 12.75 6 6 9-13.5"
                    />
                  </svg>
                  Sí</span
                >
              </label>
              <label class="flex items-center">
                <input
                  (click)="toggleEnabled('alergias', false)"
                  formControlName="tieneAlergias"
                  type="radio"
                  name="tieneAlergias"
                  id="alergiaNo"
                  [value]="0"
                  class="peer/alergia hidden"
                  required
                />
                <span
                  class="bg-red-300/50 px-3 py-3 rounded-xl flex items-center text-lg peer-checked/alergia:bg-red-600/60 peer-checked/alergia:text-white transition hover:cursor-pointer hover:ring-2 hover:ring-red-800 hover:shadow-lg"
                  [ngClass]="{
                    'ring-2 ring-red-500 shadow-lg/25 shadow-red-500':
                      esCampoInvalido('tieneAlergias')
                  }"
                  ><svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="size-6 mr-1"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M6 18 18 6M6 6l12 12"
                    />
                  </svg>
                  No</span
                >
              </label>
            </div>
          </div>
          <!-- Alergias -->
          @if (formulario.get('tieneAlergias')?.value === 1) {
          <div class="w-full flex flex-col bg-slate-100 rounded-lg p-3">
            <label for="alergias" class="block px-1 mb-3 text-lg"
              >Ingresa las alergias que tengas</label
            >
            <input
              type="text"
              formControlName="alergias"
              id="alergias"
              class="w-full max-w-md px-4 py-3 border border-gray-300 rounded-md hover:ring focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white placeholder:text-gray-400 disabled:opacity-50 transition"
              placeholder="Sulfas, Polvo, etc."
              [ngClass]="{
                'ring-2 ring-red-500 shadow-lg/25 shadow-red-500':
                  esCampoInvalido('alergias')
              }"
              required
            />
          </div>
          }
        </div>
        <!-- Discapacidad -->
        <div class="flex flex-col md:flex-row gap-4">
          <!-- TieneDiscapacidad -->
          <div class="w-full flex flex-col bg-slate-100 rounded-lg p-3">
            <label for="discapacidadSi" class="block px-1 mb-3 text-lg"
              >¿Tienes alguna discapacidad?
            </label>
            <div class="flex space-x-3">
              <label class="flex items-center">
                <input
                  (click)="toggleEnabled('discapacidad', true)"
                  formControlName="tieneDiscapacidad"
                  type="radio"
                  name="tieneDiscapacidad"
                  id="discapacidadSi"
                  [value]="1"
                  class="peer/discapacidad hidden"
                  required
                />
                <span
                  class="bg-green-300/50 px-3 py-3 rounded-xl flex items-center text-lg peer-checked/discapacidad:bg-green-600 peer-checked/discapacidad:text-white transition hover:cursor-pointer hover:ring-2 hover:ring-green-800 hover:shadow-lg"
                  [ngClass]="{
                    'ring-2 ring-red-500 shadow-lg/25 shadow-red-500':
                      esCampoInvalido('tieneDiscapacidad')
                  }"
                  ><svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="size-6 mr-1"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="m4.5 12.75 6 6 9-13.5"
                    />
                  </svg>
                  Sí</span
                >
              </label>
              <label class="flex items-center">
                <input
                  (click)="toggleEnabled('discapacidad', false)"
                  formControlName="tieneDiscapacidad"
                  type="radio"
                  name="tieneDiscapacidad"
                  id="discapacidadNo"
                  [value]="0"
                  class="peer/discapacidad hidden"
                  required
                />
                <span
                  class="bg-red-300/50 px-3 py-3 rounded-xl flex items-center text-lg peer-checked/discapacidad:bg-red-600/60 peer-checked/discapacidad:text-white transition hover:cursor-pointer hover:ring-2 hover:ring-red-800 hover:shadow-lg"
                  [ngClass]="{
                    'ring-2 ring-red-500 shadow-lg/25 shadow-red-500':
                      esCampoInvalido('tieneDiscapacidad')
                  }"
                  ><svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="size-6 mr-1"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M6 18 18 6M6 6l12 12"
                    />
                  </svg>
                  No</span
                >
              </label>
            </div>
          </div>
          <!-- Discapacidad -->
          @if (formulario.get('tieneDiscapacidad')?.value === 1) {
          <div class="w-full flex flex-col bg-slate-100 rounded-lg p-3">
            <label for="discapacidad" class="block px-1 mb-3 text-lg"
              >Ingresa la discapacidad</label
            >
            <input
              type="text"
              formControlName="discapacidad"
              id="discapacidad"
              class="w-full max-w-md px-4 py-3 border border-gray-300 rounded-md hover:ring focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white placeholder:text-gray-400 disabled:opacity-50 transition"
              placeholder="Motriz, Auditiva, Visual, etc."
              [ngClass]="{
                'ring-2 ring-red-500 shadow-lg/25 shadow-red-500':
                  esCampoInvalido('discapacidad')
              }"
              required
            />
          </div>
          }
        </div>
        <!-- TipoSangre -->
        <div class="w-full flex flex-col bg-slate-100 rounded-lg p-3">
          <label for="tipoSangre1" class="block px-1 mb-3 text-lg"
            >Selecciona tu tipo de sangre
          </label>
          <div class="flex flex-wrap gap-3">
            <ng-container *ngFor="let tipoSangre of sangre; let i = index">
              <label class="flex items-center">
                <input
                  formControlName="tipoSangre"
                  type="radio"
                  name="tipoSangre"
                  [id]="'tipoSangre' + tipoSangre.Id"
                  [value]="tipoSangre.Descripcion"
                  class="peer/tipoSangre hidden"
                  required
                />
                <span
                  class="bg-blue-300/50 px-3 py-3 rounded-xl flex items-center text-lg peer-checked/tipoSangre:bg-sky-600 peer-checked/tipoSangre:text-white transition hover:cursor-pointer hover:ring-2 hover:ring-sky-800 hover:shadow-lg cursor-pointer"
                  [ngClass]="{
                    'ring-2 ring-red-500 shadow-lg/25 shadow-red-500':
                      esCampoInvalido('tipoSangre')
                  }"
                >
                  {{ tipoSangre.Descripcion }}
                </span>
              </label>
            </ng-container>
          </div>
        </div>
      </div>
      <div class="bg-slate-800 py-6 px-6 flex items-center">
        <div class="w-1 h-8 bg-blue-400 mr-4"></div>
        <span class="text-white text-2xl">Documentos</span>
      </div>
      <!-- Documentos -->
      <div class="p-6 space-y-6">
        <div class="w-full flex flex-col bg-slate-100 rounded-lg p-3">
          <div class="block px-1 text-lg mb-4">Documentos requeridos:</div>

          <!-- Grid de documentos -->
          <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
            @for (documento of documentosRequeridos; track documento; let i =
            $index) {
            <div class="flex flex-col h-full">
              <!-- Título del documento -->
              <label
                [for]="'documento-' + i"
                class="block px-1 mb-3 text-sm font-medium min-h-[2.5rem] flex items-start"
                [ngClass]="{
                  'text-green-600': esDocumentoCargado(documento),
                  'text-gray-700': !esDocumentoCargado(documento),
                  'text-red-600':
                    !esDocumentoValido(documento) && formularioEnviado
                }"
              >
                <span class="leading-tight">
                  {{ documento }}
                  <span class="text-red-500 ml-1">*</span>
                  @if (esDocumentoCargado(documento)) {
                  <span class="text-green-600 ml-1">✓</span>
                  }
                </span>
              </label>

              <!-- Contenedor con altura fija para input file o vista del archivo cargado -->
              <div class="flex-1 min-h-[8rem] flex flex-col">
                @if (!esDocumentoCargado(documento)) {
                <!-- Input file cuando no hay archivo -->
                <div class="relative flex-1">
                  <input
                    type="file"
                    [id]="'documento-' + i"
                    class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"
                    accept=".pdf"
                    (change)="onArchivoSeleccionado($event, documento)"
                    required
                  />
                  <div
                    class="flex flex-col items-center justify-center w-full h-full border-2 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition"
                    [ngClass]="{
                      'border-gray-300': !(
                        !esDocumentoValido(documento) && formularioEnviado
                      ),
                      'border-red-500 bg-red-50':
                        !esDocumentoValido(documento) && formularioEnviado
                    }"
                  >
                    <svg
                      class="w-8 h-8 mb-2"
                      [ngClass]="{
                        'text-gray-500': !(
                          !esDocumentoValido(documento) && formularioEnviado
                        ),
                        'text-red-500':
                          !esDocumentoValido(documento) && formularioEnviado
                      }"
                      aria-hidden="true"
                      xmlns="http://www.w3.org/2000/svg"
                      fill="none"
                      viewBox="0 0 20 16"
                    >
                      <path
                        stroke="currentColor"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"
                      />
                    </svg>
                    <p
                      class="text-xs text-center mb-1"
                      [ngClass]="{
                        'text-gray-500': !(
                          !esDocumentoValido(documento) && formularioEnviado
                        ),
                        'text-red-500':
                          !esDocumentoValido(documento) && formularioEnviado
                      }"
                    >
                      <span class="font-semibold">Haz clic para subir</span>
                    </p>
                    <p
                      class="text-xs text-center"
                      [ngClass]="{
                        'text-gray-500': !(
                          !esDocumentoValido(documento) && formularioEnviado
                        ),
                        'text-red-500':
                          !esDocumentoValido(documento) && formularioEnviado
                      }"
                    >
                      Solo PDF
                    </p>
                  </div>
                </div>
                <!-- Mensaje de error -->
                @if (!esDocumentoValido(documento) && formularioEnviado) {
                <div class="mt-2 text-xs text-red-500">
                  Este documento es obligatorio
                </div>
                } } @else {
                <!-- Vista del archivo cargado - compacta -->
                <div
                  class="flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded-lg h-full"
                >
                  <div class="flex items-center flex-1 min-w-0">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke-width="1.5"
                      stroke="currentColor"
                      class="w-5 h-5 mr-2 text-green-600 flex-shrink-0"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="m4.5 12.75 6 6 9-13.5"
                      />
                    </svg>
                    <div class="min-w-0 flex-1">
                      <p class="text-sm font-medium text-green-800">
                        @if (esDocumentoExistente(documento)) { Archivo
                        existente } @else { Archivo cargado }
                      </p>
                      <p
                        class="text-xs text-green-600 truncate"
                        [title]="getNombreArchivo(documento)"
                      >
                        {{ getNombreArchivo(documento) }}
                      </p>
                      @if (esDocumentoExistente(documento)) {
                      <p class="text-xs text-gray-500">
                        Subido:
                        {{
                          getInfoDocumentoExistente(documento)?.fechaSubida
                            | date : "short"
                        }}
                      </p>
                      }
                    </div>
                  </div>
                  <button
                    type="button"
                    (click)="eliminarArchivo(documento)"
                    class="text-red-800 bg-red-300/50 p-3 rounded-lg flex items-center text-lg transition hover:cursor-pointer hover:ring-2 hover:ring-red-800 hover:shadow-lg"
                    title="Eliminar archivo"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke-width="1.5"
                      stroke="currentColor"
                      class="w-4 h-4"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M6 18 18 6M6 6l12 12"
                      />
                    </svg>
                  </button>
                </div>
                }
              </div>
            </div>
            }
          </div>

          <!-- Resumen de progreso -->
          @if (documentosRequeridos.length > 0) {
          <div class="mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
            <div class="flex items-center justify-between">
              <h4 class="text-sm font-medium text-blue-800">
                Progreso de documentos
              </h4>
              <span class="text-sm text-blue-600">
                {{ getDocumentosCargados() }}
                de {{ documentosRequeridos.length }} completados
              </span>
            </div>
            <div class="mt-2 w-full bg-blue-200 rounded-full h-2">
              <div
                class="bg-blue-600 h-2 rounded-full transition-all duration-300"
                [style.width.%]="getPorcentajeProgreso()"
              ></div>
            </div>
          </div>
          }
        </div>
      </div>
      <!-- Botón de envío -->
      <div class="p-6 text-center bg-gray-50">
        <button
          type="submit"
          class="bg-blue-400 px-3 py-2 rounded-xl text-xl focus:bg-blue-700 focus:text-white transition hover:cursor-pointer hover:ring-2 hover:ring-blue-950 hover:shadow-lg"
        >
          @if (esEdicion) { Actualizar información } @else { Enviar formulario }
        </button>
      </div>
    </form>
  </div>
</div>
